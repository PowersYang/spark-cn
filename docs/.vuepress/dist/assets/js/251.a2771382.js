(window.webpackJsonp=window.webpackJsonp||[]).push([[251],{451:function(e,a,t){"use strict";t.r(a);var r=t(0),s=Object(r.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"yarn-shared-cache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#yarn-shared-cache"}},[e._v("#")]),e._v(" YARN Shared Cache")]),e._v(" "),t("h2",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),t("p",[e._v("The YARN Shared Cache provides the facility to upload and manage shared application resources to HDFS in a safe and scalable manner. YARN applications can leverage resources uploaded by other applications or previous runs of the same application without having to re­upload and localize identical files multiple times. This will save network resources and reduce YARN application startup time.")]),e._v(" "),t("h2",{attrs:{id:"current-status-and-future-plans"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#current-status-and-future-plans"}},[e._v("#")]),e._v(" Current Status and Future Plans")]),e._v(" "),t("p",[e._v("Currently the YARN Shared Cache is released and ready to use. The major components are implemented and have been deployed in a large-scale production setting. There are still some pieces missing (i.e. strong authentication). These missing features will be implemented as part of a follow-up phase 2 effort. Please see "),t("a",{attrs:{href:"https://issues.apache.org/jira/browse/YARN-7282",target:"_blank",rel:"noopener noreferrer"}},[e._v("YARN-7282"),t("OutboundLink")],1),e._v(" for more information.")]),e._v(" "),t("h2",{attrs:{id:"architecture"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#architecture"}},[e._v("#")]),e._v(" Architecture")]),e._v(" "),t("p",[e._v("The shared cache feature consists of 4 major components:")]),e._v(" "),t("ol",[t("li",[e._v("The shared cache client.")]),e._v(" "),t("li",[e._v("The HDFS directory that acts as a cache.")]),e._v(" "),t("li",[e._v("The shared cache manager (aka. SCM).")]),e._v(" "),t("li",[e._v("The localization service and uploader.")])]),e._v(" "),t("h3",{attrs:{id:"the-shared-cache-client"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#the-shared-cache-client"}},[e._v("#")]),e._v(" The Shared Cache Client")]),e._v(" "),t("p",[e._v("YARN application developers and users, should interact with the shared cache using the shared cache client. This client is responsible for interacting with the shared cache manager, computing the checksum of application resources, and claiming application resources in the shared cache. Once an application has claimed a resource, it is free to use that resource for the life-cycle of the application. Please see the SharedCacheClient.java javadoc for further documentation.")]),e._v(" "),t("h3",{attrs:{id:"the-shared-cache-hdfs-directory"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#the-shared-cache-hdfs-directory"}},[e._v("#")]),e._v(" The Shared Cache HDFS Directory")]),e._v(" "),t("p",[e._v("The shared cache HDFS directory stores all of the shared cache resources. It is protected by HDFS permissions and is globally readable, but writing is restricted to a trusted user. This HDFS directory is only modified by the shared cache manager and the resource uploader on the node manager. Resources are spread across a set of subdirectories using the resources’s checksum:")]),e._v(" "),t("pre",[t("code",[e._v("/sharedcache/a/8/9/a896857d078/foo.jar\n/sharedcache/5/0/f/50f11b09f87/bar.jar\n/sharedcache/a/6/7/a678cb1aa8f/job.jar\n")])]),e._v(" "),t("h3",{attrs:{id:"shared-cache-manager-scm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#shared-cache-manager-scm"}},[e._v("#")]),e._v(" Shared Cache Manager (SCM)")]),e._v(" "),t("p",[e._v("The shared cache manager is responsible for serving requests from the client and managing the contents of the shared cache. It looks after both the meta data as well as the persisted resources in HDFS. It is made up of two major components, a back end store and a cleaner service. The SCM runs as a separate daemon process that can be placed on any node in the cluster. This allows for administrators to start/stop/upgrade the SCM without affecting other YARN components (i.e. the resource manager or node managers).")]),e._v(" "),t("p",[e._v("The back end store is responsible for maintaining and persisting metadata about the shared cache. This includes the resources in the cache, when a resource was last used and a list of applications that are currently using the resource. The implementation for the backing store is pluggable and it currently uses an in-memory store that recreates its state after a restart.")]),e._v(" "),t("p",[e._v("The cleaner service maintains the persisted resources in HDFS by ensuring that resources that are no longer used are removed from the cache. It scans the resources in the cache periodically and evicts resources if they are both stale and there are no live applications currently using the application.")]),e._v(" "),t("h3",{attrs:{id:"the-shared-cache-uploader-and-localization"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#the-shared-cache-uploader-and-localization"}},[e._v("#")]),e._v(" The Shared Cache uploader and localization")]),e._v(" "),t("p",[e._v("The shared cache uploader is a service that runs on the node manager and adds resources to the shared cache. It is responsible for verifying a resources checksum, uploading the resource to HDFS and notifying the shared cache manager that a resource has been added to the cache. It is important to note that the uploader service is asynchronous from the container launch and does not block the startup of a yarn application. In addition adding things to the cache is done in a best effort way and does not impact running applications. Once the uploader has placed a resource in the shared cache, YARN uses the normal node manager localization mechanism to make resources available to the application.")]),e._v(" "),t("h2",{attrs:{id:"developing-yarn-applications-with-the-shared-cache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#developing-yarn-applications-with-the-shared-cache"}},[e._v("#")]),e._v(" Developing YARN applications with the Shared Cache")]),e._v(" "),t("p",[e._v("To support the YARN shared cache, an application must use the shared cache client during application submission. The shared cache client returns a URL corresponding to a resource if it is in the shared cache. To use the cached resource, a YARN application simply uses the cached URL to create a LocalResource object and sets setShouldBeUploadedToSharedCache to true during application submission.")]),e._v(" "),t("p",[e._v("For example, here is how you would create a LocalResource using a cached URL:")]),e._v(" "),t("pre",[t("code",[e._v("String localPathChecksum = sharedCacheClient.getFileChecksum(localPath);\nURL cachedResource = sharedCacheClient.use(appId, localPathChecksum);\nLocalResource resource = LocalResource.newInstance(cachedResource,\n      LocalResourceType.FILE, LocalResourceVisibility.PUBLIC\n      size, timestamp, null, true);\n")])]),e._v(" "),t("h2",{attrs:{id:"administrating-the-shared-cache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#administrating-the-shared-cache"}},[e._v("#")]),e._v(" Administrating the Shared Cache")]),e._v(" "),t("h3",{attrs:{id:"setting-up-the-shared-cache"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#setting-up-the-shared-cache"}},[e._v("#")]),e._v(" Setting up the shared cache")]),e._v(" "),t("p",[e._v("An administrator can initially set up the shared cache by following these steps:")]),e._v(" "),t("ol",[t("li",[e._v("Create an HDFS directory for the shared cache (default: /sharedcache).")]),e._v(" "),t("li",[e._v("Set the shared cache directory permissions to 0755.")]),e._v(" "),t("li",[e._v("Ensure that the shared cache directory is owned by the user that runs the shared cache manager daemon and the node manager.")]),e._v(" "),t("li",[e._v("In the yarn-site.xml file, set yarn.sharedcache.enabled to true and yarn.sharedcache.root-dir to the directory specified in step 1. For more configuration parameters, see the configuration parameters section.")]),e._v(" "),t("li",[e._v("Start the shared cache manager:")])]),e._v(" "),t("pre",[t("code",[e._v("/hadoop/bin/yarn --daemon start sharedcachemanager\n")])]),e._v(" "),t("h3",{attrs:{id:"configuration-parameters"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configuration-parameters"}},[e._v("#")]),e._v(" Configuration parameters")]),e._v(" "),t("p",[e._v("The configuration parameters can be found in yarn-default.xml and should be set in the yarn-site.xml file. Here are a list of configuration parameters and their defaults:")]),e._v(" "),t("table",[t("thead",[t("tr",[t("th",[e._v("Name")]),e._v(" "),t("th",[e._v("Description")]),e._v(" "),t("th",[e._v("Default value")])])]),e._v(" "),t("tbody",[t("tr",[t("td",[e._v("yarn.sharedcache.enabled")]),e._v(" "),t("td",[e._v("Whether the shared cache is enabled")]),e._v(" "),t("td",[e._v("false")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.root-dir")]),e._v(" "),t("td",[e._v("The root directory for the shared cache")]),e._v(" "),t("td",[e._v("/sharedcache")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.nested-level")]),e._v(" "),t("td",[e._v("The level of nested directories before getting to the checksum directories. It must be non-negative.")]),e._v(" "),t("td",[e._v("3")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.store.class")]),e._v(" "),t("td",[e._v("The implementation to be used for the SCM store")]),e._v(" "),t("td",[e._v("org.apache.hadoop.yarn.server.sharedcachemanager.store.InMemorySCMStore")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.app-checker.class")]),e._v(" "),t("td",[e._v("The implementation to be used for the SCM app-checker")]),e._v(" "),t("td",[e._v("org.apache.hadoop.yarn.server.sharedcachemanager.RemoteAppChecker")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.store.in-memory.staleness-period-mins")]),e._v(" "),t("td",[e._v("A resource in the in-memory store is considered stale if the time since the last reference exceeds the staleness period. This value is specified in minutes.")]),e._v(" "),t("td",[e._v("10080")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.store.in-memory.initial-delay-mins")]),e._v(" "),t("td",[e._v("Initial delay before the in-memory store runs its first check to remove dead initial applications. Specified in minutes.")]),e._v(" "),t("td",[e._v("10")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.store.in-memory.check-period-mins")]),e._v(" "),t("td",[e._v("The frequency at which the in-memory store checks to remove dead initial applications. Specified in minutes.")]),e._v(" "),t("td",[e._v("720")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.admin.address")]),e._v(" "),t("td",[e._v("The address of the admin interface in the SCM (shared cache manager)")]),e._v(" "),t("td",[e._v("0.0.0.0:8047")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.admin.thread-count")]),e._v(" "),t("td",[e._v("The number of threads used to handle SCM admin interface (1 by default)")]),e._v(" "),t("td",[e._v("1")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.webapp.address")]),e._v(" "),t("td",[e._v("The address of the web application in the SCM (shared cache manager)")]),e._v(" "),t("td",[e._v("0.0.0.0:8788")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.cleaner.period-mins")]),e._v(" "),t("td",[e._v("The frequency at which a cleaner task runs. Specified in minutes.")]),e._v(" "),t("td",[e._v("1440")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.cleaner.initial-delay-mins")]),e._v(" "),t("td",[e._v("Initial delay before the first cleaner task is scheduled. Specified in minutes.")]),e._v(" "),t("td",[e._v("10")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.cleaner.resource-sleep-ms")]),e._v(" "),t("td",[e._v("The time to sleep between processing each shared cache resource. Specified in milliseconds.")]),e._v(" "),t("td",[e._v("0")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.uploader.server.address")]),e._v(" "),t("td",[e._v("The address of the node manager interface in the SCM (shared cache manager)")]),e._v(" "),t("td",[e._v("0.0.0.0:8046")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.uploader.server.thread-count")]),e._v(" "),t("td",[e._v("The number of threads used to handle shared cache manager requests from the node manager (50 by default)")]),e._v(" "),t("td",[e._v("50")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.client-server.address")]),e._v(" "),t("td",[e._v("The address of the client interface in the SCM (shared cache manager)")]),e._v(" "),t("td",[e._v("0.0.0.0:8045")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.client-server.thread-count")]),e._v(" "),t("td",[e._v("The number of threads used to handle shared cache manager requests from clients (50 by default)")]),e._v(" "),t("td",[e._v("50")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.checksum.algo.impl")]),e._v(" "),t("td",[e._v("The algorithm used to compute checksums of files (SHA-256 by default)")]),e._v(" "),t("td",[e._v("org.apache.hadoop.yarn.sharedcache.ChecksumSHA256Impl")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.nm.uploader.replication.factor")]),e._v(" "),t("td",[e._v("The replication factor for the node manager uploader for the shared cache (10 by default)")]),e._v(" "),t("td",[e._v("10")])]),e._v(" "),t("tr",[t("td",[e._v("yarn.sharedcache.nm.uploader.thread-count")]),e._v(" "),t("td",[e._v("The number of threads used to upload files from a node manager instance (20 by default)")]),e._v(" "),t("td",[e._v("20")])])])])])}),[],!1,null,null,null);a.default=s.exports}}]);