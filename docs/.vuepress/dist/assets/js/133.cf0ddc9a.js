(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{331:function(e,r,t){"use strict";t.r(r);var n=t(0),o=Object(n.a)({},(function(){var e=this,r=e.$createElement,t=e._self._c||r;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"service-discovery"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#service-discovery","aria-hidden":"true"}},[e._v("#")]),e._v(" Service Discovery")]),e._v(" "),t("p",[e._v("This document describes the mechanism of service discovery on YARN and the steps for enabling it.")]),e._v(" "),t("h2",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview","aria-hidden":"true"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),t("p",[e._v("A "),t("router-link",{attrs:{to:"/docs/hadoop-yarn/hadoop-yarn-site/yarn-service/RegistryDNS.html"}},[e._v("DNS server")]),e._v(" is implemented to enable discovering services on YARN via the standard mechanism: DNS lookup.")],1),e._v(" "),t("p",[e._v("The framework ApplicationMaster posts the container information such as hostname and IP address into the YARN service registry. The DNS server exposes the information in YARN service registry by translating them into DNS records such as A record and SRV record. Clients can then discover the IPs of containers via standard DNS lookup.")]),e._v(" "),t("p",[e._v("For non-docker containers (containers with null Artifact or with Artifact type set to TARBALL), since all containers on the same host share the same ip address, the DNS supports forward DNS lookup, but not support reverse DNS lookup. With docker, it supports both forward and reverse lookup, since each container can be configured to have its own unique IP. In addition, the DNS also supports configuring static zone files for both foward and reverse lookup.")]),e._v(" "),t("h2",{attrs:{id:"docker-container-ip-management-in-cluster"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#docker-container-ip-management-in-cluster","aria-hidden":"true"}},[e._v("#")]),e._v(" Docker Container IP Management in Cluster")]),e._v(" "),t("p",[e._v("To support the use-case of per container per IP, containers must be launched with bridge network. However, with bridge network, containers running on one node are not routable from other nodes by default. This is not an issue if you are only doing single node testing, however, for a multi-node environment, containers must be made routable from other nodes.")]),e._v(" "),t("p",[e._v("There are several approaches to solve this depending on the platforms like GCE or AWS. Please refer to specific platform documentations for how to enable this. For on-prem cluster, one way to solve this issue is, on each node, configure the docker daemon to use a custom bridge say br0 which is routable from all nodes. Also, assign an exclusive, contiguous range of IP addresses expressed in CIDR form e.g 172.21.195.240/26 (64 IPs) to each docker daemon using the fixed-cidr option like below in the docker daemon.json:")]),e._v(" "),t("pre",[t("code",[e._v('"bridge": "br0"\n"fixed-cidr": "172.21.195.240/26"\n')])]),e._v(" "),t("p",[e._v("Check how to "),t("a",{attrs:{href:"https://docs.docker.com/engine/userguide/networking/default_network/custom-docker0/",target:"_blank",rel:"noopener noreferrer"}},[e._v("customize docker bridge network"),t("OutboundLink")],1),e._v(" for details.")]),e._v(" "),t("h2",{attrs:{id:"naming-convention-with-registry-dns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#naming-convention-with-registry-dns","aria-hidden":"true"}},[e._v("#")]),e._v(" Naming Convention with Registry DNS")]),e._v(" "),t("p",[e._v("With the DNS support, user can simply access their services in a well-defined naming format as below:")]),e._v(" "),t("pre",[t("code",[e._v("${COMPONENT_INSTANCE_NAME}.${SERVICE_NAME}.${USER}.${DOMAIN}\n")])]),e._v(" "),t("p",[e._v("For example, in a cluster whose domain name is yarncluster (as defined by the hadoop.registry.dns.domain-name in yarn-site.xml), a service named hbase deployed by user devuser with two components hbasemaster and regionserver can be accessed as below:")]),e._v(" "),t("p",[e._v("This URL points to the usual hbase master UI")]),e._v(" "),t("pre",[t("code",[e._v("http://hbasemaster-0.hbase.devuser.yarncluster:16010/master-status\n")])]),e._v(" "),t("p",[e._v("Note that YARN service framework assigns COMPONENT_INSTANCE_NAME for each container in a sequence of monotonically increasing integers. For example, hbasemaster-0 gets assigned 0 since it is the first and only instance for the hbasemaster component. In case of regionserver component, it can have multiple containers and so be named as such: regionserver-0, regionserver-1, regionserver-2 â€¦ etc")]),e._v(" "),t("p",[e._v("Each YARN service component also has Multi-A Records for container fault tolerance or load balancing via RegistryDNS. The naming format is defined as:")]),e._v(" "),t("pre",[t("code",[e._v("${COMPONENT_NAME}.${SERVICE_NAME}.${USER}.${DOMAIN}\n")])]),e._v(" "),t("p",[e._v("For example, a component named www for application app launched by Chuck with 3 containers will have DNS records that look like:")]),e._v(" "),t("pre",[t("code",[e._v("www.app.chuck.example.com IN A 123.123.123.1\nwww.app.chuck.example.com IN A 123.123.123.1\nwww.app.chuck.example.com IN A 123.123.123.1\n")])]),e._v(" "),t("p",[e._v("Disclaimer: The DNS implementation is still experimental. It should not be used as a fully-functional DNS.")]),e._v(" "),t("h2",{attrs:{id:"configure-registry-dns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#configure-registry-dns","aria-hidden":"true"}},[e._v("#")]),e._v(" Configure Registry DNS")]),e._v(" "),t("p",[e._v("Below is the set of configurations in yarn-site.xml required for enabling Registry DNS. A full list of properties can be found in the Configuration section of "),t("router-link",{attrs:{to:"/docs/hadoop-yarn/hadoop-yarn-site/yarn-service/RegistryDNS.html"}},[e._v("Registry DNS")]),e._v(".")],1),e._v(" "),t("pre",[t("code",[e._v("  <property>\n    <description>The domain name for Hadoop cluster associated records.</description>\n    <name>hadoop.registry.dns.domain-name</name>\n    <value>ycluster</value>\n  </property>\n\n  <property>\n    <description>The port number for the DNS listener. The default port is 5335.\n    If the standard privileged port 53 is used, make sure start the DNS with jsvc support.</description>\n    <name>hadoop.registry.dns.bind-port</name>\n    <value>5335</value>\n  </property>\n\n  <property>\n    <description>The DNS functionality is enabled for the cluster. Default is false.</description>\n    <name>hadoop.registry.dns.enabled</name>\n    <value>true</value>\n  </property>\n\n  <property>\n    <description>Address associated with the network interface to which the DNS listener should bind.</description>\n    <name>hadoop.registry.dns.bind-address</name>\n    <value>localhost</value>\n  </property>\n\n  <property>\n    <description> A comma separated list of hostname:port pairs defining the zookeeper quorum for the YARN registry</description>\n    <name>hadoop.registry.zk.quorum</name>\n    <value>localhost:2181</value>\n  </property>\n")])]),e._v(" "),t("p",[e._v("To configure Registry DNS to serve reverse lookup for 172.17.0.0/24")]),e._v(" "),t("pre",[t("code",[e._v("  <property>\n    <description>The network mask associated with the zone IP range. If specified, it is utilized to ascertain the\n    IP range possible and come up with an appropriate reverse zone name.</description>\n    <name>hadoop.registry.dns.zone-mask</name>\n    <value>255.255.255.0</value>\n  </property>\n\n  <property>\n    <description>An indicator of the IP range associated with the cluster containers. The setting is utilized for the\n     generation of the reverse zone name.</description>\n    <name>hadoop.registry.dns.zone-subnet</name>\n    <value>172.17.0.0</value>\n  </property>\n")])]),e._v(" "),t("h2",{attrs:{id:"start-registry-dns-server"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#start-registry-dns-server","aria-hidden":"true"}},[e._v("#")]),e._v(" Start Registry DNS Server")]),e._v(" "),t("p",[e._v("By default, the DNS server runs on non-privileged port 5335. Start the server with:")]),e._v(" "),t("pre",[t("code",[e._v("yarn --daemon start registrydns\n")])]),e._v(" "),t("p",[e._v("If the DNS server is configured to use the standard privileged port 53, the environment variables YARN_REGISTRYDNS_SECURE_USER and YARN_REGISTRYDNS_SECURE_EXTRA_OPTS must be uncommented in the yarn-env.sh file. The DNS server should then be launched as root and jsvc will be used to reduce the privileges of the daemon after the port has been bound.")]),e._v(" "),t("h2",{attrs:{id:"make-your-cluster-use-registry-dns"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#make-your-cluster-use-registry-dns","aria-hidden":"true"}},[e._v("#")]),e._v(" Make your cluster use Registry DNS")]),e._v(" "),t("p",[e._v("You can edit the /etc/resolv.conf to make your system use the registry DNS such as below, where 192.168.154.3 is the ip address of your DNS host. It should appear before any nameservers that would return NXDOMAIN for lookups in the domain used by the cluster.")]),e._v(" "),t("pre",[t("code",[e._v("nameserver 192.168.154.3\n")])]),e._v(" "),t("p",[e._v("Alternatively, if you have a corporate DNS in your organization, you can configure zone forwarding so that the Registry DNS resolves hostnames for the domain used by the cluster.")])])}),[],!1,null,null,null);r.default=o.exports}}]);