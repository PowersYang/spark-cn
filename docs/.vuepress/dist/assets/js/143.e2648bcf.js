(window.webpackJsonp=window.webpackJsonp||[]).push([[143],{342:function(e,n,t){"use strict";t.r(n);var a=t(0),o=Object(a.a)({},(function(){var e=this,n=e.$createElement,t=e._self._c||n;return t("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[t("h1",{attrs:{id:"hadoop-aliyun-module-integration-with-aliyun-web-services"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hadoop-aliyun-module-integration-with-aliyun-web-services"}},[e._v("#")]),e._v(" Hadoop-Aliyun module: Integration with Aliyun Web Services")]),e._v(" "),t("h2",{attrs:{id:"overview"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),t("p",[e._v("The hadoop-aliyun module provides support for Aliyun integration with "),t("a",{attrs:{href:"https://www.aliyun.com/product/oss",target:"_blank",rel:"noopener noreferrer"}},[e._v("Aliyun Object Storage Service (Aliyun OSS)"),t("OutboundLink")],1),e._v(". The generated JAR file, hadoop-aliyun.jar also declares a transitive dependency on all external artifacts which are needed for this support — enabling downstream applications to easily use this support.")]),e._v(" "),t("p",[e._v("To make it part of Apache Hadoop’s default classpath, simply make sure that HADOOP_OPTIONAL_TOOLS in hadoop-env.sh has ‘hadoop-aliyun’ in the list.")]),e._v(" "),t("h3",{attrs:{id:"features"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#features"}},[e._v("#")]),e._v(" Features")]),e._v(" "),t("ul",[t("li",[e._v("Read and write data stored in Aliyun OSS.")]),e._v(" "),t("li",[e._v("Present a hierarchical file system view by implementing the standard Hadoop "),t("router-link",{attrs:{to:"/en/docs/hadoop-aliyun/tools/api/org/apache/hadoop/fs/FileSystem.html"}},[e._v("FileSystem")]),e._v(" interface.")],1),e._v(" "),t("li",[e._v("Can act as a source of data in a MapReduce job, or a sink.")])]),e._v(" "),t("h3",{attrs:{id:"warning-1-object-stores-are-not-filesystems"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#warning-1-object-stores-are-not-filesystems"}},[e._v("#")]),e._v(" Warning #1: Object Stores are not filesystems.")]),e._v(" "),t("p",[e._v("Aliyun OSS is an example of “an object store”. In order to achieve scalability and especially high availability, Aliyun OSS has relaxed some of the constraints which classic “POSIX” filesystems promise.")]),e._v(" "),t("p",[e._v("Specifically")]),e._v(" "),t("ol",[t("li",[e._v("Atomic operations: delete() and rename() are implemented by recursive file-by-file operations. They take time at least proportional to the number of files, during which time partial updates may be visible. delete() and rename() can not guarantee atomicity. If the operations are interrupted, the filesystem is left in an intermediate state.")]),e._v(" "),t("li",[e._v("File owner and group are persisted, but the permissions model is not enforced. Authorization occurs at the level of the entire Aliyun account via "),t("a",{attrs:{href:"https://www.aliyun.com/product/ram",target:"_blank",rel:"noopener noreferrer"}},[e._v("Aliyun Resource Access Management (Aliyun RAM)"),t("OutboundLink")],1),e._v(".")]),e._v(" "),t("li",[e._v("Directory last access time is not tracked.")]),e._v(" "),t("li",[e._v("The append operation is not supported.")])]),e._v(" "),t("h3",{attrs:{id:"warning-2-directory-last-access-time-is-not-tracked"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#warning-2-directory-last-access-time-is-not-tracked"}},[e._v("#")]),e._v(" Warning #2: Directory last access time is not tracked,")]),e._v(" "),t("p",[e._v("Features of Hadoop relying on this can have unexpected behaviour. E.g. the AggregatedLogDeletionService of YARN will not remove the appropriate log files.")]),e._v(" "),t("h3",{attrs:{id:"warning-3-your-aliyun-credentials-are-valuable"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#warning-3-your-aliyun-credentials-are-valuable"}},[e._v("#")]),e._v(" Warning #3: Your Aliyun credentials are valuable")]),e._v(" "),t("p",[e._v("Your Aliyun credentials not only pay for services, they offer read and write access to the data. Anyone with the account can not only read your datasets — they can delete them.")]),e._v(" "),t("p",[e._v("Do not inadvertently share these credentials through means such as 1. Checking in to SCM any configuration files containing the secrets. 2. Logging them to a console, as they invariably end up being seen. 3. Defining filesystem URIs with the credentials in the URL, such as oss://accessKeyId:accessKeySecret@directory/file. They will end up in logs and error messages. 4. Including the secrets in bug reports.")]),e._v(" "),t("p",[e._v("If you do any of these: change your credentials immediately!")]),e._v(" "),t("h3",{attrs:{id:"warning-4-the-aliyun-oss-client-provided-by-aliyun-e-mapreduce-are-different-from-this-implementation"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#warning-4-the-aliyun-oss-client-provided-by-aliyun-e-mapreduce-are-different-from-this-implementation"}},[e._v("#")]),e._v(" Warning #4: The Aliyun OSS client provided by Aliyun E-MapReduce are different from this implementation")]),e._v(" "),t("p",[e._v("Specifically: on Aliyun E-MapReduce, oss:// is also supported but with a different implementation. If you are using Aliyun E-MapReduce, follow these instructions —and be aware that all issues related to Aliyun OSS integration in E-MapReduce can only be addressed by Aliyun themselves: please raise your issues with them.")]),e._v(" "),t("h2",{attrs:{id:"oss"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#oss"}},[e._v("#")]),e._v(" OSS")]),e._v(" "),t("h3",{attrs:{id:"authentication-properties"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#authentication-properties"}},[e._v("#")]),e._v(" Authentication properties")]),e._v(" "),t("pre",[t("code",[e._v("<property>\n  <name>fs.oss.accessKeyId</name>\n  <description>Aliyun access key ID</description>\n</property>\n\n<property>\n  <name>fs.oss.accessKeySecret</name>\n  <description>Aliyun access key secret</description>\n</property>\n\n<property>\n  <name>fs.oss.credentials.provider</name>\n  <description>\n    Class name of a credentials provider that implements\n    com.aliyun.oss.common.auth.CredentialsProvider. Omit if using access/secret keys\n    or another authentication mechanism. The specified class must provide an\n    accessible constructor accepting java.net.URI and\n    org.apache.hadoop.conf.Configuration, or an accessible default constructor.\n  </description>\n</property>\n")])]),e._v(" "),t("h3",{attrs:{id:"other-properties"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#other-properties"}},[e._v("#")]),e._v(" Other properties")]),e._v(" "),t("pre",[t("code",[e._v("<property>\n  <name>fs.AbstractFileSystem.oss.impl</name>\n  <value>org.apache.hadoop.fs.aliyun.oss.OSS</value>\n  <description>The implementation class of the OSS AbstractFileSystem.\n    If you want to use OSS as YARN’s resource storage dir via the\n    fs.defaultFS configuration property in Hadoop’s core-site.xml,\n    you should add this configuration to Hadoop's core-site.xml\n  </description>\n</property>\n\n<property>\n  <name>fs.oss.endpoint</name>\n  <description>Aliyun OSS endpoint to connect to. An up-to-date list is\n    provided in the Aliyun OSS Documentation.\n   </description>\n</property>\n\n<property>\n   <name>fs.oss.impl</name>\n   <value>org.apache.hadoop.fs.aliyun.oss.AliyunOSSFileSystem</value>\n</property>\n\n<property>\n  <name>fs.oss.proxy.host</name>\n  <description>Hostname of the (optinal) proxy server for Aliyun OSS connection</description>\n</property>\n\n<property>\n  <name>fs.oss.proxy.port</name>\n  <description>Proxy server port</description>\n</property>\n\n<property>\n  <name>fs.oss.proxy.username</name>\n  <description>Username for authenticating with proxy server</description>\n</property>\n\n<property>\n  <name>fs.oss.proxy.password</name>\n  <description>Password for authenticating with proxy server.</description>\n</property>\n\n<property>\n  <name>fs.oss.proxy.domain</name>\n  <description>Domain for authenticating with proxy server.</description>\n</property>\n\n<property>\n  <name>fs.oss.proxy.workstation</name>\n  <description>Workstation for authenticating with proxy server.</description>\n</property>\n\n<property>\n  <name>fs.oss.attempts.maximum</name>\n  <value>20</value>\n  <description>How many times we should retry commands on transient errors.</description>\n</property>\n\n<property>\n  <name>fs.oss.connection.establish.timeout</name>\n  <value>50000</value>\n  <description>Connection setup timeout in milliseconds.</description>\n</property>\n\n<property>\n  <name>fs.oss.connection.timeout</name>\n  <value>200000</value>\n  <description>Socket connection timeout in milliseconds.</description>\n</property>\n\n<property>\n  <name>fs.oss.paging.maximum</name>\n  <value>1000</value>\n  <description>How many keys to request from Aliyun OSS when doing directory listings at a time.\n  </description>\n</property>\n\n<property>\n  <name>fs.oss.multipart.upload.size</name>\n  <value>10485760</value>\n  <description>Size of each of multipart pieces in bytes.</description>\n</property>\n\n<property>\n  <name>fs.oss.upload.active.blocks</name>\n  <value>4</value>\n  <description>Active(Concurrent) upload blocks when uploading a file.</description>\n</property>\n\n<property>\n  <name>fs.oss.multipart.download.threads</name>\n  <value>10</value>\n  <description>The maximum number of threads allowed in the pool for multipart download and upload.</description>\n</property>\n\n<property>\n  <name>fs.oss.multipart.download.ahead.part.max.number</name>\n  <value>4</value>\n  <description>The maximum number of read ahead parts when reading a file.</description>\n</property>\n\n<property>\n  <name>fs.oss.max.total.tasks</name>\n  <value>128</value>\n  <description>The maximum queue number for multipart download and upload.</description>\n</property>\n\n<property>\n  <name>fs.oss.max.copy.threads</name>\n  <value>25</value>\n  <description>The maximum number of threads allowed in the pool for copy operations.</description>\n</property>\n\n<property>\n  <name>fs.oss.max.copy.tasks.per.dir</name>\n  <value>5</value>\n  <description>The maximum number of concurrent tasks allowed when copying a directory.</description>\n</property>\n\n<property>\n  <name>fs.oss.multipart.upload.threshold</name>\n  <value>20971520</value>\n  <description>Minimum size in bytes before we start a multipart uploads or copy.\n    Notice: This property is deprecated and will be removed in further version.\n  </description>\n</property>\n\n<property>\n  <name>fs.oss.multipart.download.size</name>\n  <value>102400/value>\n  <description>Size in bytes in each request from ALiyun OSS.</description>\n</property>\n\n<property>\n  <name>fs.oss.buffer.dir</name>\n  <description>Comma separated list of directories to buffer OSS data before uploading to Aliyun OSS</description>\n</property>\n\n<property>\n  <name>fs.oss.acl.default</name>\n  <value></vaule>\n  <description>Set a canned ACL for bucket. Value may be private, public-read, public-read-write.\n  </description>\n</property>\n\n<property>\n  <name>fs.oss.server-side-encryption-algorithm</name>\n  <value></vaule>\n  <description>Specify a server-side encryption algorithm for oss: file system.\n     Unset by default, and the only other currently allowable value is AES256.\n  </description>\n</property>\n\n<property>\n  <name>fs.oss.connection.maximum</name>\n  <value>32</value>\n  <description>Number of simultaneous connections to oss.</description>\n</property>\n\n<property>\n  <name>fs.oss.connection.secure.enabled</name>\n  <value>true</value>\n  <description>Connect to oss over ssl or not, true by default.</description>\n</property>\n")])]),e._v(" "),t("h2",{attrs:{id:"testing-the-hadoop-aliyun-module"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#testing-the-hadoop-aliyun-module"}},[e._v("#")]),e._v(" Testing the hadoop-aliyun Module")]),e._v(" "),t("p",[e._v("To test oss:// filesystem client, two files which pass in authentication details to the test runner are needed.")]),e._v(" "),t("ol",[t("li",[e._v("auth-keys.xml")]),e._v(" "),t("li",[e._v("core-site.xml")])]),e._v(" "),t("p",[e._v("Those two configuration files must be put into hadoop-tools/hadoop-aliyun/src/test/resources.")]),e._v(" "),t("h3",{attrs:{id:"core-site-xml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#core-site-xml"}},[e._v("#")]),e._v(" core-site.xml")]),e._v(" "),t("p",[e._v("This file pre-exists and sources the configurations created in auth-keys.xml.")]),e._v(" "),t("p",[e._v("For most cases, no modification is needed, unless a specific, non-default property needs to be set during the testing.")]),e._v(" "),t("h3",{attrs:{id:"auth-keys-xml"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#auth-keys-xml"}},[e._v("#")]),e._v(" auth-keys.xml")]),e._v(" "),t("p",[e._v("This file triggers the testing of Aliyun OSS module. Without this file, none of the tests in this module will be executed")]),e._v(" "),t("p",[e._v("It contains the access key Id/secret and proxy information that are needed to connect to Aliyun OSS, and an OSS bucket URL should be also provided.")]),e._v(" "),t("ol",[t("li",[e._v("test.fs.oss.name : the URL of the bucket for Aliyun OSS tests")])]),e._v(" "),t("p",[e._v("The contents of the bucket will be cleaned during the testing process, so do not use the bucket for any purpose other than testing.")]),e._v(" "),t("h3",{attrs:{id:"run-hadoop-contract-tests"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#run-hadoop-contract-tests"}},[e._v("#")]),e._v(" Run Hadoop contract tests")]),e._v(" "),t("p",[e._v("Create file contract-test-options.xml under /test/resources. If a specific file fs.contract.test.fs.oss test path is not defined, those tests will be skipped. Credentials are also needed to run any of those tests, they can be copied from auth-keys.xml or through direct XInclude inclusion. Here is an example of contract-test-options.xml:")]),e._v(" "),t("pre",[t("code",[e._v('<?xml version="1.0"?>\n<?xml-stylesheet type="text/xsl" href="configuration.xsl"?>\n<configuration>\n\n<include xmlns="http://www.w3.org/2001/XInclude"\nhref="auth-keys.xml"/>\n\n  <property>\n    <name>fs.contract.test.fs.oss</name>\n    <value>oss://spark-tests</value>\n  </property>\n\n  <property>\n    <name>fs.oss.impl</name>\n    <value>org.apache.hadoop.fs.aliyun.oss.AliyunOSSFileSystem</value>\n  </property>\n\n  <property>\n    <name>fs.oss.endpoint</name>\n    <value>oss-cn-hangzhou.aliyuncs.com</value>\n  </property>\n\n  <property>\n    <name>fs.oss.buffer.dir</name>\n    <value>/tmp/oss</value>\n  </property>\n\n  <property>\n    <name>fs.oss.multipart.download.size</name>\n    <value>102400</value>\n  </property>\n</configuration>\n')])])])}),[],!1,null,null,null);n.default=o.exports}}]);